From 764c39633aa4bb8b94463dd19961bb4e9c78be26 Mon Sep 17 00:00:00 2001
From: Maarten van Gompel <proycon@anaproy.nl>
Date: Sun, 31 Mar 2024 13:57:24 +0200
Subject: [PATCH] debug: include trailing \0 byte in call to
 zwp_virtual_keyboard_v1.keymap()

Ref: https://github.com/jjsullivan5196/wvkbd/issues/70
---
 keyboard.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/keyboard.c b/keyboard.c
index afe0639..cd9a11e 100644
--- a/keyboard.c
+++ b/keyboard.c
@@ -678,7 +678,7 @@ create_and_upload_keymap(struct kbd *kb, const char *name, uint32_t comp_unichr,
     size_t keymap_size = strlen(keymap_template) + 64;
     char *keymap_str = malloc(keymap_size);
     sprintf(keymap_str, keymap_template, comp_unichr, comp_shift_unichr);
-    keymap_size = strlen(keymap_str);
+    keymap_size = strlen(keymap_str) + 1;
     int keymap_fd = os_create_anonymous_file(keymap_size);
     if (keymap_fd < 0) {
         die("could not create keymap fd\n");
-- 
2.49.0

