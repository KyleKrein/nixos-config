* NixOS Config

** Apply cloned config

#+begin_src shell
sudo nixos-rebuild switch --flake ~/nixos-config#kylekrein-homepc
#+end_src

** Rebuild system

#+begin_src shell
nh os switch
#+end_src

** Generate hardware report
#+begin_src shell
sudo nix run \
  --option experimental-features "nix-command flakes" \
  --option extra-substituters https://numtide.cachix.org \
  --option extra-trusted-public-keys numtide.cachix.org-1:2ps1kLBUWjxIneOy1Ik6cQjb41X0iXVXeHigGmycPPE= \
  github:numtide/nixos-facter -- -o facter.json
#+end_src

* Install system

Assuming that you're in nixos installer

#+begin_src shell
sudo nix --extra-experimental-features "flakes nix-command" run github:nix-community/disko -- --mode destroy,format,mount --yes-wipe-all-disks --flake github:KyleKrein/nixos-config#kylekrein-homepc
#+end_src

Copy sops age keys to `/persist/sops/age/keys.txt` or to
`/var/lib/sops/age/keys.txt` if not using impermanence

#+begin_src shell
sudo mkdir -p /mnt/tmp && TMPDIR=/mnt/tmp sudo nixos-install --flake github:KyleKrein/nixos-config#kylekrein-homepc --no-root-passwd && sudo rm -rf /mnt/tmp
#+end_src
